<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2: Notion Connection Test</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f4f5; color: #18181b; padding: 40px; }
        #app { max-width: 600px; margin: auto; background: white; padding: 20px 40px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #1e293b; }
        #milestone-list { list-style-type: none; padding-left: 0; }
        #milestone-list li { background-color: #f1f5f9; margin-bottom: 8px; padding: 12px; border-radius: 4px; border-left: 4px solid #3b82f6; }
        .error { color: #dc2626; background: #fef2f2; padding: 12px; border-radius: 4px; border-left: 4px solid #ef4444; }
    </style>
</head>
<body>

    <div id="app">
        <h1>Renovation Project Milestones</h1>
        <div id="status">
            <p>Attempting to connect to Notion...</p>
        </div>
        <ul id="milestone-list">
            </ul>
    </div>

    <script>
        // --- CONFIGURATION ---
        // After deploying the `api/proxy.js` file, you will get a URL.
        // PASTE THAT FULL URL HERE.
        const BACKEND_API_URL = 'https://your-backend-url.com/api/proxy'; // <-- IMPORTANT: Replace this later

        const statusDiv = document.getElementById('status');
        const milestoneList = document.getElementById('milestone-list');

        async function fetchMilestones() {
            // Pre-flight check to ensure the URL has been configured.
            if (BACKEND_API_URL.includes('your-backend-url.com')) {
                statusDiv.innerHTML = `<p class="error"><strong>Configuration Error:</strong> Please open index.html and replace the placeholder BACKEND_API_URL with your actual deployment URL.</p>`;
                return;
            }

            try {
                const response = await fetch(BACKEND_API_URL);
                if (!response.ok) {
                    throw new Error(`The server responded with status: ${response.status}`);
                }
                const data = await response.json();

                if (data.length > 0) {
                    statusDiv.innerHTML = `<p style="color: #166534;"><strong>Success!</strong> Connection to Notion is live. Milestones fetched:</p>`;
                    milestoneList.innerHTML = ''; // Clear list
                    data.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = item.title;
                        milestoneList.appendChild(li);
                    });
                } else {
                    statusDiv.innerHTML = `<p class="error"><strong>Connection successful, but no data found.</strong> Please ensure you have added a few rows of data to your Notion database.</p>`;
                }

            } catch (error) {
                console.error('Fetch Error:', error);
                statusDiv.innerHTML = `<p class="error"><strong>Failed to connect.</strong> Could not fetch data from the backend. Please check the URL and ensure the backend function is deployed correctly.</p>`;
            }
        }

        // Fetch data when the page loads
        document.addEventListener('DOMContentLoaded', fetchMilestones);
    </script>
</body>
</html>

